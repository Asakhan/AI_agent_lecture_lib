tests/test_task_planner.py íŒŒì¼ì„ ìƒì„±í•˜ê³ 
TaskPlannerì˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

[íŒŒì¼ ìœ„ì¹˜]
tests/test_task_planner.py

[êµ¬í˜„ ë‚´ìš©]

"""TaskPlanner ë‹¨ìœ„ í…ŒìŠ¤íŠ¸"""
import sys
import os
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from openai import OpenAI
from src.task_planner import TaskPlanner, TaskStatus, Subtask


def test_subtask_creation():
    """Subtask ìƒì„± í…ŒìŠ¤íŠ¸"""
    print("\n" + "="*50)
    print("TEST 1: Subtask Creation")
    print("="*50)
    
    task = Subtask(id="task_1", description="í…ŒìŠ¤íŠ¸ íƒœìŠ¤í¬", priority=1)
    
    assert task.id == "task_1"
    assert task.status == TaskStatus.PENDING
    assert task.attempts == 0
    print("âœ… ê¸°ë³¸ Subtask ìƒì„± ì„±ê³µ")
    
    task2 = Subtask(id="task_2", description="ì˜ì¡´ì„± íƒœìŠ¤í¬", priority=2, dependencies=["task_1"])
    assert "task_1" in task2.dependencies
    print("âœ… ì˜ì¡´ì„± Subtask ìƒì„± ì„±ê³µ")
    
    return True


def test_task_decomposition():
    """ì‘ì—… ë¶„í•´ í…ŒìŠ¤íŠ¸"""
    print("\n" + "="*50)
    print("TEST 2: Task Decomposition")
    print("="*50)
    
    client = OpenAI()
    planner = TaskPlanner(client)
    
    tasks = planner.decompose("ì „ê¸°ì°¨ ì‹œì¥ ë™í–¥ ë¶„ì„")
    
    assert len(tasks) >= 3
    assert len(tasks) <= 7
    print(f"âœ… {len(tasks)}ê°œ íƒœìŠ¤í¬ë¡œ ë¶„í•´ë¨")
    
    for task in tasks:
        assert task.id.startswith("task_")
        assert len(task.description) > 0
        print(f"  - {task.id}: {task.description[:40]}...")
    
    return True


def test_dependency_management():
    """ì˜ì¡´ì„± ê´€ë¦¬ í…ŒìŠ¤íŠ¸"""
    print("\n" + "="*50)
    print("TEST 3: Dependency Management")
    print("="*50)
    
    client = OpenAI()
    planner = TaskPlanner(client)
    
    planner.tasks = [
        Subtask(id="task_1", description="ì¡°ì‚¬", priority=1),
        Subtask(id="task_2", description="ë¶„ì„", priority=2, dependencies=["task_1"]),
        Subtask(id="task_3", description="ì •ë¦¬", priority=3, dependencies=["task_1", "task_2"]),
    ]
    planner.original_goal = "í…ŒìŠ¤íŠ¸"
    
    next_task = planner.get_next_task()
    assert next_task.id == "task_1"
    print("âœ… ì˜ì¡´ì„± ì—†ëŠ” íƒœìŠ¤í¬ ìš°ì„  ì„ íƒ")
    
    planner.tasks[0].status = TaskStatus.PENDING
    task2 = planner._get_task_by_id("task_2")
    assert not planner._dependencies_met(task2)
    print("âœ… ë¯¸ì¶©ì¡± ì˜ì¡´ì„± ì •ìƒ ê°ì§€")
    
    planner.tasks[0].status = TaskStatus.COMPLETED
    assert planner._dependencies_met(task2)
    print("âœ… ì¶©ì¡± ì˜ì¡´ì„± ì •ìƒ ê°ì§€")
    
    return True


def test_task_execution_flow():
    """íƒœìŠ¤í¬ ì‹¤í–‰ íë¦„ í…ŒìŠ¤íŠ¸"""
    print("\n" + "="*50)
    print("TEST 4: Task Execution Flow")
    print("="*50)
    
    client = OpenAI()
    planner = TaskPlanner(client)
    
    planner.decompose("Python íŠœí† ë¦¬ì–¼ ì‘ì„±")
    print(f"ğŸ“‹ ì´ {len(planner.tasks)}ê°œ íƒœìŠ¤í¬")
    planner.visualize()
    
    iteration = 0
    while not planner.is_complete() and iteration < 20:
        task = planner.get_next_task()
        if not task:
            break
        
        print(f"ğŸ”„ ì‹¤í–‰ ì¤‘: {task.id}")
        planner.update_status(task.id, TaskStatus.COMPLETED, f"{task.id} ê²°ê³¼")
        iteration += 1
    
    planner.visualize()
    assert planner.is_complete()
    print("âœ… ì „ì²´ ì‹¤í–‰ íë¦„ í…ŒìŠ¤íŠ¸ ì„±ê³µ")
    
    return True


def test_retry_mechanism():
    """ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ í…ŒìŠ¤íŠ¸"""
    print("\n" + "="*50)
    print("TEST 5: Retry Mechanism")
    print("="*50)
    
    client = OpenAI()
    planner = TaskPlanner(client)
    
    planner.tasks = [
        Subtask(id="task_1", description="ì‹¤íŒ¨í•  íƒœìŠ¤í¬", priority=1, max_attempts=3),
    ]
    planner.original_goal = "ì¬ì‹œë„ í…ŒìŠ¤íŠ¸"
    
    task = planner.get_next_task()
    assert task.attempts == 1
    print(f"âœ… 1ì°¨ ì‹œë„")
    
    planner.update_status(task.id, TaskStatus.FAILED)
    
    task = planner.get_next_task()
    assert task.attempts == 2
    print(f"âœ… 2ì°¨ ì‹œë„")
    
    planner.update_status(task.id, TaskStatus.FAILED)
    task = planner.get_next_task()
    assert task.attempts == 3
    print(f"âœ… 3ì°¨ ì‹œë„")
    
    planner.update_status(task.id, TaskStatus.FAILED)
    task = planner.get_next_task()
    assert task is None
    print("âœ… max_attempts ì´ˆê³¼ í›„ ì¬ì‹œë„ ì°¨ë‹¨")
    
    return True


def run_all_tests():
    """ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰"""
    print("\nğŸ§ª TaskPlanner ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹œì‘ " + "="*30)
    
    tests = [
        ("Subtask Creation", test_subtask_creation),
        ("Task Decomposition", test_task_decomposition),
        ("Dependency Management", test_dependency_management),
        ("Execution Flow", test_task_execution_flow),
        ("Retry Mechanism", test_retry_mechanism),
    ]
    
    results = []
    for name, test_func in tests:
        try:
            result = test_func()
            results.append((name, "PASS" if result else "FAIL"))
        except Exception as e:
            print(f"âŒ {name} ì‹¤íŒ¨: {e}")
            results.append((name, "ERROR"))
    
    print("\n" + "="*50)
    print("ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½")
    print("="*50)
    
    for name, status in results:
        icon = "âœ…" if status == "PASS" else "âŒ"
        print(f"{icon} {name}: {status}")
    
    passed = sum(1 for _, s in results if s == "PASS")
    print(f"\nì´ ê²°ê³¼: {passed}/{len(results)} í†µê³¼")
    
    return passed == len(results)


if __name__ == "__main__":
    import sys
    success = run_all_tests()
    sys.exit(0 if success else 1)

[ì‹¤í–‰ ë°©ë²•]
python tests/test_task_planner.py